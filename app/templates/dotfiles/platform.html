{% extends "base.html" %} {% block head %}
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
{% endblock %} {% block content %}
<section class="py-20">
    <div class="w-full px-8">
        <div class="mb-8">
            <a
                href="/dotfiles"
                class="text-text-muted hover:text-text-primary transition"
            >
                &larr; Back to Dotfiles
            </a>
        </div>

        <div class="flex items-center justify-between mb-8">
            <h1 class="text-4xl font-bold gradient-text">{{ title }}</h1>
            <a
                href="/dotfiles/keybinds?platform={{ platform }}"
                class="px-6 py-3 bg-accent-blue hover:bg-accent-blue/80 rounded-lg font-medium transition text-dark-900"
            >
                View Keybinds
            </a>
        </div>

        <div class="bg-dark-700 rounded-xl p-8 border border-dark-600">
            <div id="readme-loading" class="text-center py-12">
                <div
                    class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-accent-blue"
                ></div>
                <p class="text-text-muted mt-4">Loading README...</p>
            </div>
            <div id="readme-content" class="readme-content hidden"></div>
            <div id="readme-error" class="text-center py-12 hidden">
                <p class="text-accent-red">Failed to load README</p>
            </div>
        </div>
    </div>
</section>
{% endblock %} {% block scripts %}
<script>
    const platform = "{{ platform }}";

    function addCopyButtons() {
        const clipboardIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>`;
        const checkIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>`;

        const codeBlocks = document.querySelectorAll(".readme-content pre");
        codeBlocks.forEach((pre) => {
            const btn = document.createElement("button");
            btn.className = "copy-btn";
            btn.innerHTML = clipboardIcon;
            btn.addEventListener("click", async () => {
                const code = pre.querySelector("code");
                const text = code ? code.textContent : pre.textContent;
                await navigator.clipboard.writeText(text);
                btn.innerHTML = checkIcon;
                btn.classList.add("copied");
                setTimeout(() => {
                    btn.innerHTML = clipboardIcon;
                    btn.classList.remove("copied");
                }, 2000);
            });
            pre.appendChild(btn);
        });
    }

    async function loadReadme() {
        const loading = document.getElementById("readme-loading");
        const content = document.getElementById("readme-content");
        const error = document.getElementById("readme-error");

        try {
            const response = await fetch(`/api/github/readme/${platform}`);
            if (!response.ok) throw new Error("Failed to fetch");

            const data = await response.json();
            content.innerHTML = DOMPurify.sanitize(marked.parse(data.content));
            addCopyButtons();

            loading.classList.add("hidden");
            content.classList.remove("hidden");
        } catch (e) {
            loading.classList.add("hidden");
            error.classList.remove("hidden");
        }
    }

    loadReadme();
</script>
{% endblock %}
