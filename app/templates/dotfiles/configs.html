{% extends "base.html" %} {% block head %}
<style>
    .highlight {
        background: #1a1a24;
        border-radius: 8px;
        overflow-x: auto;
    }
    .highlight pre {
        margin: 0;
        padding: 16px;
    }
    .highlight .linenos {
        color: #4a5568;
        padding-right: 16px;
        border-right: 1px solid #2d3748;
        margin-right: 16px;
        user-select: none;
    }
</style>
{% endblock %} {% block content %}
<section class="py-12" x-data="configBrowser()">
    <div class="max-w-6xl mx-auto px-6">
        <h1 class="text-3xl font-bold mb-2 gradient-text">Config Browser</h1>
        <p class="text-gray-400 mb-8">
            Browse configuration files from my dotfiles repositories
        </p>

        <div class="flex gap-2 mb-8">
            <button
                @click='selectRepo("yabai")'
                :class='currentRepo === "yabai" ? "bg-accent-500" : "bg-dark-700"'
                class="px-4 py-2 rounded-lg transition"
            >
                Yabai
            </button>
            <button
                @click='selectRepo("hyprland")'
                :class='currentRepo === "hyprland" ? "bg-accent-500" : "bg-dark-700"'
                class="px-4 py-2 rounded-lg transition"
            >
                Hyprland
            </button>
        </div>

        <div class="grid md:grid-cols-4 gap-6">
            <div class="bg-dark-800 rounded-xl border border-dark-600 p-4">
                <h3 class="font-semibold mb-4">Files</h3>
                <div class="space-y-1">
                    <template
                        x-for="file in configFiles[currentRepo]"
                        :key="file"
                    >
                        <button
                            @click="loadFile(file)"
                            :class='selectedFile === file ? "bg-accent-500/20 text-accent-500" : "hover:bg-dark-700"'
                            class="w-full text-left px-3 py-2 rounded text-sm mono transition"
                            x-text="file"
                        ></button>
                    </template>
                </div>
            </div>

            <div
                class="md:col-span-3 bg-dark-800 rounded-xl border border-dark-600 overflow-hidden"
            >
                <div
                    class="bg-dark-700 px-4 py-2 border-b border-dark-600 flex justify-between items-center"
                >
                    <span
                        class="mono text-sm"
                        x-text='selectedFile || "Select a file"'
                    ></span>
                    <span
                        class="text-xs text-gray-500"
                        x-text="language"
                    ></span>
                </div>
                <div class="p-4 overflow-x-auto">
                    <template x-if="loading">
                        <p class="text-gray-400">Loading...</p>
                    </template>
                    <template x-if="!loading && !fileContent">
                        <p class="text-gray-400">
                            Select a file to view its contents
                        </p>
                    </template>
                    <div x-show="fileContent" x-html="highlightedContent"></div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %} {% block scripts %}
<script>
    function configBrowser() {
        return {
            currentRepo:
                new URLSearchParams(window.location.search).get("repo") ||
                "yabai",
            selectedFile: null,
            fileContent: null,
            highlightedContent: "",
            language: "",
            loading: false,

            configFiles: {
                yabai: [
                    "yabairc",
                    "skhdrc",
                    "bordersrc",
                    "sketchybar/sketchybarrc",
                    "sketchybar/colors.sh",
                    "reload-theme.py",
                    "Keybinds.md",
                ],
                hyprland: [
                    "hyprland.conf",
                    "KEYBINDS.md",
                    "kitty/kitty.conf",
                    "waybar/config",
                    "waybar/style.css",
                    "pywal.sh",
                ],
            },

            repos: {
                yabai: "duma799/yabaduma-config",
                hyprland: "duma799/hyprduma-config",
            },

            selectRepo(repo) {
                this.currentRepo = repo;
                this.selectedFile = null;
                this.fileContent = null;
                this.highlightedContent = "";
                history.pushState({}, "", "?repo=" + repo);
            },

            async loadFile(file) {
                this.selectedFile = file;
                this.loading = true;
                try {
                    const repo = this.repos[this.currentRepo];
                    const resp = await fetch(
                        "/api/configs/" + repo + "/file/" + file,
                    );
                    if (resp.ok) {
                        const data = await resp.json();
                        this.fileContent = data.content;
                        this.highlightedContent = data.highlighted_html;
                        this.language = data.language;
                    }
                } catch (e) {
                    console.error(e);
                }
                this.loading = false;
            },
        };
    }
</script>
{% endblock %}
